<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warhammer 40k - Secondary Import Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        textarea { font-family: monospace; }
    </style>
</head>
<body class="bg-gray-900 text-white p-8">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-yellow-400">Secondary Mission Importer</h1>
            <p class="text-gray-400 mt-2">Paste your JSON data below to update the lists in your Firebase database.</p>
        </header>

        <div class="space-y-6">
            <div>
                <label for="fixedJson" class="block text-lg font-semibold mb-2">Fixed Objectives JSON</label>
                <textarea id="fixedJson" rows="10" class="w-full bg-gray-800 text-white p-2 rounded-md border border-gray-700 focus:ring-2 focus:ring-sky-500 focus:outline-none" placeholder="Paste your Fixed Objectives JSON array here..."></textarea>
            </div>
            <div>
                <label for="tacticalJson" class="block text-lg font-semibold mb-2">Tactical Objectives JSON</label>
                <textarea id="tacticalJson" rows="10" class="w-full bg-gray-800 text-white p-2 rounded-md border border-gray-700 focus:ring-2 focus:ring-sky-500 focus:outline-none" placeholder="Paste your Tactical Objectives JSON array here..."></textarea>
            </div>
        </div>

        <div class="text-center mt-8">
            <button id="importBtn" class="bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-lg text-xl">Import Data</button>
        </div>
        
        <div id="status" class="mt-6 text-center text-lg font-mono p-4 bg-black rounded-md h-16"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = {
          apiKey: "AIzaSyAlhqPMvqP1MO_sV_jIXf7jrrm1MJtL2aI",
          authDomain: "wtwg-streaming.firebaseapp.com",
          projectId: "wtwg-streaming",
          storageBucket: "wtwg-streaming.appspot.com",
          messagingSenderId: "889956031791",
          appId: "1:889956031791:web:d9292c951c8270f6abd5da",
          measurementId: "G-5T9HMW7DMX"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        const importBtn = document.getElementById('importBtn');
        const statusEl = document.getElementById('status');
        const fixedJsonEl = document.getElementById('fixedJson');
        const tacticalJsonEl = document.getElementById('tacticalJson');

        async function handleImport() {
            statusEl.textContent = 'Connecting...';
            statusEl.classList.remove('text-green-400', 'text-red-400');

            try {
                await signInAnonymously(auth);
                statusEl.textContent = 'Authenticated. Preparing data...';

                const fixedText = fixedJsonEl.value.trim();
                const tacticalText = tacticalJsonEl.value.trim();

                if (!fixedText || !tacticalText) {
                    throw new Error("Both text boxes must contain JSON data.");
                }

                const fixedData = JSON.parse(fixedText);
                const tacticalData = JSON.parse(tacticalText);

                if (!Array.isArray(fixedData) || !Array.isArray(tacticalData)) {
                    throw new Error("Data must be in the format of a JSON array (starts with [ and ends with ]).");
                }
                
                statusEl.textContent = 'Data validated. Uploading...';

                const docId = "warhammer-game-data";
                const appDocRef = doc(db, "gamedata", docId);

                await updateDoc(appDocRef, {
                    fixed_objectives: fixedData,
                    tactical_objectives: tacticalData
                });

                statusEl.textContent = 'SUCCESS: Data imported successfully!';
                statusEl.classList.add('text-green-400');

            } catch (error) {
                statusEl.textContent = `ERROR: ${error.message}`;
                statusEl.classList.add('text-red-400');
                console.error("Import failed:", error);
            }
        }

        importBtn.addEventListener('click', handleImport);
    </script>
</body>
</html>
